<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Game 4 - ƒêo√°n Ch·ªØ ƒê·∫£o L·ªôn</title>
<style>
  body { font-family: 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg,#004080,#00A1D6); color:#fff; margin:0; padding:10px; text-align:center; min-height:100vh;}
  .controls { display:flex; gap:10px; margin-bottom:15px; justify-content:center; flex-wrap:wrap;}
  .btn { padding:8px 16px; font-size:14px; background:#0077cc; color:#fff; border:none; border-radius:8px; cursor:pointer; box-shadow:0 4px 6px rgba(0,0,0,0.2); text-decoration:none;}
  .btn:hover { background:#005f99;}
  .btn:disabled { background:#ccc; cursor:not-allowed;}
  h1 { margin:10px 0; font-weight:700; color:#fff; font-size:24px;}
  p.lead { color:#fff; font-size:1.2rem; font-weight:600; margin-bottom:10px;}
  #scrambled, #answer { margin:15px auto; display:flex; justify-content:center; gap:8px; flex-wrap:wrap; max-width:90%;}
  .letter { width:36px; height:36px; line-height:36px; border:2px solid #0077cc; border-radius:6px; background:#0077cc; color:#fff; font-weight:bold; font-size:1.2rem; user-select:none; cursor:grab; touch-action: manipulation;}
  .letter.dragging, .letter.touching { opacity:0.5; cursor:grabbing;}
  .slot { width:36px; height:36px; border:2px dashed #ccc; border-radius:6px; vertical-align:middle;}
  #result { margin-top:15px; font-size:1.3rem; font-weight:700;}
  #form-container { display:none; background:#fff; padding:20px; border-radius:10px; box-shadow:0 4px 8px rgba(0,0,0,0.2); margin:15px auto; max-width:90%; width:300px; flex-direction:column; align-items:center;}
  #form-container h2 { color:#004080; margin-bottom:10px; font-size:18px;}
  #form-container p { color:#333; margin-bottom:15px; font-size:14px;}
  #form-container input { display:block; width:100%; padding:10px; margin:8px 0; border:1px solid #ccc; border-radius:6px; font-size:14px; box-sizing:border-box;}
  #form-container button { background:#28a745; color:#fff; padding:8px 16px; font-size:14px; border:none; border-radius:6px; cursor:pointer;}
  #form-container button:hover { background:#1e7e34;}
  @media (max-width:400px){ .letter,.slot{width:32px;height:32px;line-height:32px;font-size:1rem;} .controls{gap:8px;} .btn{padding:6px 12px; font-size:12px;} h1{font-size:20px;} p.lead{font-size:1rem;} }
</style>
</head>
<body>
<div class="controls">
<a href="index.html" class="btn">‚¨Ö Quay l·∫°i menu</a>
<button id="changeWordBtn" class="btn">ƒê·ªïi t·ª´</button>
<button id="checkBtn" class="btn">Ki·ªÉm tra k·∫øt qu·∫£</button>
</div>
<h1>üé≤ Game 4: ƒêo√°n Ch·ªØ ƒê·∫£o L·ªôn</h1>
<p class="lead">K√©o ho·∫∑c ch·∫°m v√† th·∫£ c√°c ch·ªØ c√°i v√†o √¥ tr·ªëng ƒë·ªÉ t·∫°o t·ª´ ƒë√∫ng.</p>
<div id="answer"></div>
<div id="scrambled"></div>
<div id="result"></div>
<div id="form-container">
<h2>üéâ Ch√∫c m·ª´ng b·∫°n ƒë√£ th·∫Øng!</h2>
<p>Vui l√≤ng nh·∫≠p th√¥ng tin ƒë·ªÉ nh·∫≠n qu√†:</p>
<input type="text" id="serial" placeholder="S·ªë th·ª© t·ª± (b·ªëc t·∫°i qu·∫ßy)" required>
<input type="text" id="name" placeholder="H·ªç v√† t√™n" required>
<input type="email" id="email" placeholder="Email" required>
<input type="tel" id="phone" placeholder="S·ªë ƒëi·ªán tho·∫°i" required>
<button id="submitFormBtn" class="btn">G·ª≠i th√¥ng tin</button>
</div>

<script>
const words = ["T√ÄIKHO·∫¢N","L√ÉISU·∫§T","TH·∫∫T√çND·ª§NG","VAYV·ªêN","TI·∫æTKI·ªÜM","CHUY·ªÇNKHO·∫¢N","ATM","NG√ÇNH√ÄNG","T√ÄICH√çNH","ƒê·∫¶UT∆Ø"];
let currentWord = words[Math.floor(Math.random()*words.length)];
let changeCount = 0;
const maxChanges = 3;
const answerDiv=document.getElementById('answer');
const scrambledDiv=document.getElementById('scrambled');
const checkBtn=document.getElementById('checkBtn');
const changeWordBtn=document.getElementById('changeWordBtn');
const resultDiv=document.getElementById('result');
const formContainer=document.getElementById('form-container');
const submitFormBtn=document.getElementById('submitFormBtn');
let dragged=null;
let touchElement=null;

function shuffleArray(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}}

function initGame(){
    touchElement=null; // reset bi·∫øn khi init
    const letters=currentWord.split('');
    let scrambledLetters=[...letters];
    shuffleArray(scrambledLetters);
    answerDiv.innerHTML='';
    scrambledDiv.innerHTML='';
    resultDiv.textContent='';
    formContainer.style.display='none';
    answerDiv.style.display='flex';
    scrambledDiv.style.display='flex';
    for(let ch of letters){
        const slot=document.createElement('div');
        slot.classList.add('slot');
        slot.dataset.correct=ch;
        slot.addEventListener('dragover',e=>e.preventDefault());
        slot.addEventListener('drop',dropHandler);
        answerDiv.appendChild(slot);
    }
    for(let ch of scrambledLetters){
        const letterDiv=document.createElement('div');
        letterDiv.classList.add('letter');
        letterDiv.textContent=ch;
        letterDiv.draggable=true;
        letterDiv.addEventListener('dragstart',dragStartHandler);
        letterDiv.addEventListener('dragend',dragEndHandler);
        letterDiv.addEventListener('touchstart',touchStartHandler);
        letterDiv.addEventListener('touchmove',touchMoveHandler);
        letterDiv.addEventListener('touchend',touchEndHandler);
        scrambledDiv.appendChild(letterDiv);
    }
}

function dragStartHandler(e){dragged=e.target;e.target.classList.add('dragging');}
function dragEndHandler(e){e.target.classList.remove('dragging');dragged=null;}
function dropHandler(e){e.preventDefault();if(e.target.classList.contains('slot')&&!e.target.hasChildNodes()&&dragged){e.target.appendChild(dragged);}}

function touchStartHandler(e){
    if(e.target.classList.contains('letter')){
        touchElement=e.target;
        const rect=touchElement.getBoundingClientRect();
        touchElement.offsetX=e.touches[0].clientX-rect.left;
        touchElement.offsetY=e.touches[0].clientY-rect.top;
        touchElement.style.position='absolute';
        touchElement.style.zIndex=1000;
        document.body.appendChild(touchElement);
    }
}

function touchMoveHandler(e){
    if(touchElement){e.preventDefault();const touch=e.touches[0];touchElement.style.left=(touch.clientX-touchElement.offsetX)+'px';touchElement.style.top=(touch.clientY-touchElement.offsetY)+'px';}
}

function touchEndHandler(e){
    if(!touchElement) return;
    const touch=e.changedTouches[0];
    const target=document.elementFromPoint(touch.clientX,touch.clientY);
    if(target && target.classList.contains('slot') && !target.hasChildNodes()){
        target.appendChild(touchElement);
    } else { scrambledDiv.appendChild(touchElement); }
    touchElement.style.position='static';
    touchElement.style.left='';
    touchElement.style.top='';
    touchElement.style.zIndex='';
    touchElement=null;
}

function checkResult(){
    const slots=answerDiv.querySelectorAll('.slot');
    let correct=true;
    for(let slot of slots){
        const ch=slot.dataset.correct;
        if(!slot.firstChild){ resultDiv.style.color='#ff0000'; resultDiv.textContent='‚ö†Ô∏è Ch∆∞a ƒëi·ªÅn ƒë·ªß ch·ªØ c√°i!'; return;}
        if(slot.firstChild.textContent!==ch){ correct=false; break;}
    }
    if(correct){
        resultDiv.style.color='#28a745';
        resultDiv.textContent='üéâ Ch√∫c m·ª´ng! B·∫°n ƒë√£ s·∫Øp x·∫øp ƒë√∫ng t·ª´.';
        formContainer.style.display='flex';
        answerDiv.style.display='none';
        scrambledDiv.style.display='none';
        checkBtn.style.display='none';
        changeWordBtn.style.display='none';
    } else {
        resultDiv.style.color='#ff0000';
        resultDiv.textContent='‚ùå Ch∆∞a ƒë√∫ng! H√£y th·ª≠ l·∫°i.';
    }
}

function changeWord(){
    if(changeCount>=maxChanges){alert('B·∫°n ƒë√£ h·∫øt s·ªë l·∫ßn ƒë·ªïi t·ª´!'); changeWordBtn.disabled=true; return;}
    changeCount++;
    currentWord=words[Math.floor(Math.random()*words.length)];
    initGame();
    changeWordBtn.textContent=`ƒê·ªïi t·ª´ (${maxChanges-changeCount} l·∫ßn c√≤n l·∫°i)`;
    if(changeCount>=maxChanges) changeWordBtn.disabled=true;
}

function submitForm(){
    const serial=document.getElementById('serial').value;
    const name=document.getElementById('name').value;
    const email=document.getElementById('email').value;
    const phone=document.getElementById('phone').value;
    if(!serial||!name||!email||!phone){alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!');return;}
    if(!serial.match(/^[A-Za-z0-9]+$/)){alert('S·ªë th·ª© t·ª± ch·ªâ ch·ª©a ch·ªØ c√°i v√† s·ªë!'); return;}
    if(!email.match(/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/)){alert('Email kh√¥ng h·ª£p l·ªá!'); return;}
    if(!phone.match(/^\d{10,11}$/)){alert('S·ªë ƒëi·ªán tho·∫°i ph·∫£i 10-11 ch·ªØ s·ªë!'); return;}
    const formData=new FormData();
    formData.append('entry.1410113608',serial);
    formData.append('entry.1256122884',name);
    formData.append('entry.1376561036',phone);
    formData.append('entry.1497839970','Th·∫Øng');
    fetch('https://docs.google.com/forms/d/e/1FAIpQLSceII5vCUUPT5BHklId4o1DVJRHpIGP6M_PFLwluQ5Ksl5NNw/formResponse',{
        method:'POST',
        body:formData,
        mode:'no-cors'
    }).then(()=>{
        alert('Th√¥ng tin ƒë√£ ƒë∆∞·ª£c g·ª≠i! C·∫£m ∆°n b·∫°n.');
        formContainer.style.display='none';
        changeCount=0;
        changeWordBtn.disabled=false;
        changeWordBtn.textContent=`ƒê·ªïi t·ª´ (${maxChanges} l·∫ßn c√≤n l·∫°i)`;
        checkBtn.style.display='inline-block';
        currentWord=words[Math.floor(Math.random()*words.length)];
        initGame();
    });
}

checkBtn.addEventListener('click',checkResult);
changeWordBtn.addEventListener('click',changeWord);
submitFormBtn.addEventListener('click',submitForm);
changeWordBtn.textContent=`ƒê·ªïi t·ª´ (${maxChanges} l·∫ßn c√≤n l·∫°i)`;
initGame();
</script>
</body>
</html>
