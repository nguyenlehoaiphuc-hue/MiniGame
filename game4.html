<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Game 4 - ƒêo√°n Ch·ªØ ƒê·∫£o L·ªôn</title>
<style>
  body {
    font-family: 'Segoe UI', Arial, sans-serif;
    background: linear-gradient(135deg, #004080, #00A1D6);
    color: #fff;
    margin: 0;
    padding: 20px;
    text-align: center;
    min-height: 100vh;
  }
  .controls {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    justify-content: center;
  }
  .btn {
    padding: 10px 20px;
    font-size: 16px;
    background: #0077cc;
    color: #fff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    text-decoration: none;
  }
  .btn:hover {
    background: #005f99;
  }
  .btn:disabled {
    background: #ccc;
    cursor: not-allowed;
  }
  h1 {
    margin: 10px 0;
    font-weight: 700;
    color: #fff;
  }
  p.lead {
    color: #fff;
    font-size: 1.4rem;
    font-weight: 600;
    margin-bottom: 12px;
  }
  #scrambled, #answer {
    margin: 20px auto;
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
    max-width: 500px;
  }
  .letter {
    width: 44px;
    height: 44px;
    line-height: 44px;
    border: 2px solid #0077cc;
    border-radius: 6px;
    background-color: #0077cc;
    color: #fff;
    font-weight: bold;
    font-size: 1.4rem;
    user-select: none;
    cursor: grab;
  }
  .letter.dragging {
    opacity: 0.5;
    cursor: grabbing;
  }
  .slot {
    width: 44px;
    height: 44px;
    border: 2px dashed #ccc;
    border-radius: 6px;
    vertical-align: middle;
  }
  #result {
    margin-top: 20px;
    font-size: 1.5rem;
    font-weight: 700;
  }
  #form-container {
    display: none;
    background: #fff;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    margin: 20px auto;
    max-width: 500px;
    width: 90%;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #form-container h2 {
    color: #004080;
    margin-bottom: 15px;
  }
  #form-container p {
    color: #333;
    margin-bottom: 20px;
  }
  #form-container input {
    display: block;
    width: 100%;
    max-width: 400px;
    padding: 12px;
    margin: 10px 0;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 16px;
    box-sizing: border-box;
  }
  #form-container button {
    background: #28a745;
    color: #fff;
    padding: 10px 20px;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  #form-container button:hover {
    background: #1e7e34;
  }
</style>
</head>
<body>
  <div class="controls">
    <a href="index.html" class="btn">‚¨Ö Quay l·∫°i menu</a>
    <button id="changeWordBtn" class="btn">ƒê·ªïi t·ª´</button>
    <button id="checkBtn" class="btn">Ki·ªÉm tra k·∫øt qu·∫£</button>
  </div>
  <h1>üé≤ Game 4: ƒêo√°n Ch·ªØ ƒê·∫£o L·ªôn</h1>
  <p class="lead">K√©o c√°c ch·ªØ c√°i v√†o √¥ tr·ªëng ƒë√∫ng v·ªã tr√≠ ƒë·ªÉ t·∫°o th√†nh t·ª´ ch√≠nh x√°c.</p>
  <div id="answer"></div>
  <div id="scrambled"></div>
  <div id="result"></div>
  <div id="form-container">
    <h2>üéâ Ch√∫c m·ª´ng b·∫°n ƒë√£ th·∫Øng!</h2>
    <p>Vui l√≤ng nh·∫≠p th√¥ng tin ƒë·ªÉ nh·∫≠n qu√†:</p>
    <input type="text" id="serial" placeholder="S·ªë th·ª© t·ª± (b·ªëc t·∫°i qu·∫ßy)" required>
    <input type="text" id="name" placeholder="H·ªç v√† t√™n" required>
    <input type="email" id="email" placeholder="Email" required>
    <input type="tel" id="phone" placeholder="S·ªë ƒëi·ªán tho·∫°i" required>
    <button id="submitFormBtn" class="btn">G·ª≠i th√¥ng tin</button>
  </div>
<script>
  const words = [
    "T√ÄIKHO·∫¢N", "L√ÉISU·∫§T", "TH·∫∫T√çND·ª§NG", "VAYV·ªêN", "TI·∫æTKI·ªÜM",
    "CHUY·ªÇNKHO·∫¢N", "ATM", "NG√ÇNH√ÄNG", "T√ÄICH√çNH", "ƒê·∫¶UT∆Ø",
    "C·ªîPHI·∫æU", "TR√ÅIPHI·∫æU", "QU·ª∏ƒê·∫¶UT∆Ø", "B·∫¢OHI·ªÇM", "TI·ªÄNM·∫∂T",
    "S·ªîTI·∫æTKI·ªÜM", "L√ÉIK√âP", "T·ª∂GI√Å", "NGO·∫†IT·ªÜ", "V√ÄNG",
    "B·∫†C", "CHOVAY", "N·ª¢X·∫§U", "T√ÄIS·∫¢N", "N·ª¢PH·∫¢ITR·∫¢",
    "DOANHTHU", "L·ª¢INHU·∫¨N", "CHIPH√ç", "B√ÅOC√ÅO", "KI·ªÇMTO√ÅN",
    "QUYƒê·ªäNH", "PH√ÅPLU·∫¨T", "KH√ÅCHH√ÄNG", "D·ªäCHV·ª§", "INTERNETBANKING",
    "MOBILEBANKING", "TH·∫∫GHIN·ª¢", "M√ÉOTP", "B·∫¢OM·∫¨T", "R·ª¶IRO",
    "QU·∫¢NL√ù", "CHINH√ÅNH", "GIAOD·ªäCH", "BI√äNLAI", "H√ìAƒê∆†N",
    "THU·∫æ", "PH√çD·ªäCHV·ª§", "L√ÉISU·∫§TC·ªêƒê·ªäNH", "L√ÉISU·∫§TTH·∫¢N·ªîI", "VAYMUANH√Ä",
    "THANHTO√ÅN"
  ];
  let currentWord = words[Math.floor(Math.random() * words.length)];
  let changeCount = 0;
  const maxChanges = 3;

  const answerDiv = document.getElementById('answer');
  const scrambledDiv = document.getElementById('scrambled');
  const checkBtn = document.getElementById('checkBtn');
  const changeWordBtn = document.getElementById('changeWordBtn');
  const resultDiv = document.getElementById('result');
  const formContainer = document.getElementById('form-container');
  const submitFormBtn = document.getElementById('submitFormBtn');

  function shuffleArray(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
  }

  function initGame() {
    const letters = currentWord.split('');
    let scrambledLetters = [...letters];
    shuffleArray(scrambledLetters);

    answerDiv.innerHTML = '';
    scrambledDiv.innerHTML = '';
    resultDiv.textContent = '';
    formContainer.style.display = 'none';
    answerDiv.style.display = 'flex';
    scrambledDiv.style.display = 'flex';

    for (let ch of letters) {
      const slot = document.createElement('div');
      slot.classList.add('slot');
      slot.dataset.correct = ch;
      slot.addEventListener('dragover', (e) => e.preventDefault());
      slot.addEventListener('drop', dropHandler);
      answerDiv.appendChild(slot);
    }

    for (let ch of scrambledLetters) {
      const letterDiv = document.createElement('div');
      letterDiv.classList.add('letter');
      letterDiv.textContent = ch;
      letterDiv.draggable = true;
      letterDiv.addEventListener('dragstart', dragStartHandler);
      letterDiv.addEventListener('dragend', dragEndHandler);
      scrambledDiv.appendChild(letterDiv);
    }
  }

  let dragged;

  function dragStartHandler(e) {
    dragged = e.target;
    e.target.classList.add('dragging');
  }
  function dragEndHandler(e) {
    e.target.classList.remove('dragging');
  }
  function dropHandler(e) {
    e.preventDefault();
    if (e.target.classList.contains('slot') && !e.target.hasChildNodes()) {
      e.target.appendChild(dragged);
    }
  }

  function checkResult() {
    let correct = true;
    const slots = answerDiv.querySelectorAll('.slot');
    for (let slot of slots) {
      const ch = slot.dataset.correct;
      if (!slot.firstChild) {
        resultDiv.style.color = '#ff0000';
        resultDiv.textContent = '‚ö†Ô∏è Ch∆∞a ƒëi·ªÅn ƒë·ªß ch·ªØ c√°i v√†o c√°c √¥. Vui l√≤ng k√©o ƒë·∫ßy ƒë·ªß!';
        return;
      }
      if (slot.firstChild.textContent !== ch) {
        correct = false;
        break;
      }
    }

    if (correct) {
      resultDiv.style.color = '#28a745';
      resultDiv.textContent = 'üéâ Ch√∫c m·ª´ng! B·∫°n ƒë√£ s·∫Øp x·∫øp ƒë√∫ng t·ª´.';
      formContainer.style.display = 'flex';
      answerDiv.style.display = 'none';
      scrambledDiv.style.display = 'none';
      checkBtn.style.display = 'none';
      changeWordBtn.style.display = 'none';
    } else {
      resultDiv.style.color = '#ff0000';
      resultDiv.textContent = '‚ùå Ch∆∞a ƒë√∫ng! H√£y th·ª≠ l·∫°i.';
    }
  }

  function changeWord() {
    if (changeCount >= maxChanges) {
      alert('B·∫°n ƒë√£ s·ª≠ d·ª•ng h·∫øt s·ªë l·∫ßn ƒë·ªïi t·ª´!');
      changeWordBtn.disabled = true;
      return;
    }
    changeCount++;
    currentWord = words[Math.floor(Math.random() * words.length)];
    initGame();
    changeWordBtn.textContent = `ƒê·ªïi t·ª´ (${maxChanges - changeCount} l·∫ßn c√≤n l·∫°i)`;
    if (changeCount >= maxChanges) {
      changeWordBtn.disabled = true;
    }
  }

  function submitForm() {
    const serial = document.getElementById('serial').value;
    const name = document.getElementById('name').value;
    const email = document.getElementById('email').value;
    const phone = document.getElementById('phone').value;

    if (!serial || !name || !email || !phone) {
      alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin, bao g·ªìm S·ªë th·ª© t·ª±!');
      return;
    }

    // Ki·ªÉm tra ƒë·ªãnh d·∫°ng S·ªë th·ª© t·ª± (ch·ªâ ch·∫•p nh·∫≠n ch·ªØ c√°i v√† s·ªë)
    if (!serial.match(/^[A-Za-z0-9]+$/)) {
      alert('S·ªë th·ª© t·ª± ch·ªâ ƒë∆∞·ª£c ch·ª©a ch·ªØ c√°i v√† s·ªë (v√≠ d·ª•: A123 ho·∫∑c 123)!');
      return;
    }

    // Ki·ªÉm tra ƒë·ªãnh d·∫°ng email
    if (!email.match(/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/)) {
      alert('Email kh√¥ng h·ª£p l·ªá!');
      return;
    }

    // Ki·ªÉm tra ƒë·ªãnh d·∫°ng s·ªë ƒëi·ªán tho·∫°i (10-11 ch·ªØ s·ªë)
    if (!phone.match(/^\d{10,11}$/)) {
      alert('S·ªë ƒëi·ªán tho·∫°i ph·∫£i c√≥ 10-11 ch·ªØ s·ªë!');
      return;
    }

    const formData = new FormData();
    formData.append('entry.1410113608', serial); // S·ªë th·ª© t·ª±
    formData.append('entry.1256122884', name); // H·ªç t√™n
    formData.append('entry.1376561036', phone); // S·ªë ƒëi·ªán tho·∫°i
    formData.append('entry.1497839970', 'ƒêo√°n Ch·ªØ'); // K·∫øt qu·∫£

    fetch('https://docs.google.com/forms/d/e/1FAIpQLSceII5vCUUPT5BHklId4o1DVJRHpIGP6M_PFLwluQ5Ksl5NNw/formResponse', {
      method: 'POST',
      body: formData,
      mode: 'no-cors'
    })
    .then(() => {
      alert('Th√¥ng tin ƒë√£ ƒë∆∞·ª£c g·ª≠i! C·∫£m ∆°n b·∫°n ƒë√£ tham gia.');
      formContainer.style.display = 'none';
      changeCount = 0;
      changeWordBtn.disabled = false;
      changeWordBtn.textContent = `ƒê·ªïi t·ª´ (${maxChanges} l·∫ßn c√≤n l·∫°i)`;
      checkBtn.style.display = 'inline-block';
      currentWord = words[Math.floor(Math.random() * words.length)];
      initGame();
    })
    .catch(error => {
      alert('L·ªói khi g·ª≠i th√¥ng tin: ' + error.message);
    });
  }

  checkBtn.addEventListener('click', checkResult);
  changeWordBtn.addEventListener('click', changeWord);
  submitFormBtn.addEventListener('click', submitForm);

  changeWordBtn.textContent = `ƒê·ªïi t·ª´ (${maxChanges} l·∫ßn c√≤n l·∫°i)`;
  initGame();
</script>
</body>
</html>
